<html>
	<head>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		<script src="http://code.jquery.com/jquery-3.3.1.min.js"></script>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>

		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
		<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.20/datatables.min.css"/>
 
		<script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.20/datatables.min.js"></script>

		<script src="https://kit.fontawesome.com/d11174c44a.js" crossorigin="anonymous"></script>
	</head>

	<body>
		<div class="jumbotron" style="background-image: url('https://www.bigcommerce.com/blog/wp-content/uploads/2018/02/ecommerce-hero.jpg'); background-repeat: no-repeat; background-size: cover; background-position: center center;">
			<div class="row">
					<div class="col-md-12">
						<center><h1 style="color:#ADEFD1FF;">Using Data To Bring Customers Home </h1></center>
						<center><h4 style="color:#ADEFD1FF;"> Transforming e-commerce through predictive analytics. </h4></center>
					</div>
			</div>
		</div>
		<div class="container">
			<table id="example" class="table">
				<thead>
					<tr>
						<th>cuid</th>
						<th>roll_up</th>
						<th>currentstatus</th>
						<th>companytypegroup</th>
						<th>team</th>
						<th>customersource</th>
						<th>Action</th>
					</tr>
				</thead>
			</table>
		</div>
	
		<!-- Modal -->
		<div id="myModal" class="modal fade" role="dialog">
	  	<div class="modal-dialog">

	    <!-- Modal content-->
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal">&times;</button>
	      </div>
	      <div class="modal-body">

	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	      </div>
	    </div>

	<script>
		$(document).ready(function() {
    		var table = $("#example").DataTable( {
        		"ajax": "customer_data.json",
        		"columns": [
					{ 'data' : 'cuid'},
					{ 'data' : 'roll_up'},
					{ 'data' : 'currentstatus'},
					{ 'data' : 'companytypegroup'},
					{ 'data' : 'team'},
					{ 'data' : 'customersource'},
					{"defaultContent": "<button class='btn btn-primary'>Predict</button>"}
        		],
     
    		} );

    		$('#example tbody').on( 'click', 'button', function () {
        		var data = table.row( $(this).parents('tr') ).data();
        		$.ajax({
        			url: "http://127.0.0.1:5000/api/" + data.cuid,
        			success: function(data) {
        				console.log(data)
        				content = ""
        				if(data.conv == 0) { 
        					content = "<center><i class='fa fa-user-minus'></i> <br />This customer is not likely to convert</center><br />"
        					messages = "<center><h3>Key points</h3></center>"
        					if(data.message == "") {
        						messages += "There are no key points"
        					} else {
        						messages += data.message;
        					}
        					content += "<center><i class='fa fa-clipboard-check'></i> <br />" + messages + "</center><br />";
        				}
        				else
        				{
        					content = "<center><i class='fa fa-user-plus'></i><br />This customer is likely to convert. The revenue that is likely to be generated from the customer is " + data.revenue + "</center><br />"

        				}


        				$(".modal-body").html(content);

        				$("#myModal").modal();

        			}
        		})
    		} );

    		console.log(table);
		} );
	</script>
</html>
